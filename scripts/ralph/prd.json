{
  "project": "TwoCups",
  "version": "1.0.0",
  "lastUpdated": "2026-01-14",
  "description": "The Two of Cups - Gamified relationship maintenance app where couples track ways they fill each other's emotional cups",
  
  "summary": {
    "implemented": [
      "Firebase project & hosting configured",
      "Expo web build pipeline",
      "Basic auth (email/password + anonymous)",
      "Couple creation with invite codes",
      "Couple join flow with validation",
      "Log attempt API with request auto-fulfillment",
      "Acknowledge attempt API with gem/cup rewards",
      "Create request API",
      "Suggestion CRUD APIs",
      "Session management via Firestore listeners"
    ],
    "partiallyImplemented": [
      "Auth flow (working but unreliable on web)",
      "Pairing UI (exists but needs hardening)",
      "Log Attempt screen (needs requests/suggestions display)",
      "Acknowledge screen (needs filters/polish)",
      "Real-time sync (basic listeners exist)"
    ],
    "notImplemented": [
      "Dashboard with cup visualizations",
      "Daily attempt limit (20/day)",
      "Active request limit (5/player)",
      "Cup overflow celebrations",
      "History/timeline view",
      "Analytics dashboard",
      "Push notifications",
      "Streaks & achievements",
      "Theme customization"
    ],
    "currentBlockers": [
      "Anonymous auth unreliable in browser",
      "Firebase Console may need domain/provider config",
      "HomeScreen is just a placeholder"
    ]
  },

  "phases": [
    {
      "id": "P0_auth_pairing",
      "name": "Stabilize Authentication & Pairing",
      "status": "in_progress",
      "priority": "critical",
      "description": "Fix auth reliability and ensure couple pairing works end-to-end",
      "tasks": [
        {
          "id": "AUTH-1",
          "summary": "Fix Firebase auth configuration for web",
          "description": "Ensure Anonymous and Email/Password providers are enabled in Firebase Console. Add deployed domain and localhost to Authorized domains.",
          "status": "todo",
          "priority": "P0",
          "effort": "S",
          "acceptance": [
            "Anonymous auth works in browser without errors",
            "Email/password sign-up and sign-in work",
            "User remains authenticated after page refresh"
          ]
        },
        {
          "id": "AUTH-2",
          "summary": "Decide on auth mode for MVP",
          "description": "Choose whether to keep anonymous auth or require email/password only. Update UI accordingly.",
          "status": "todo",
          "priority": "P0",
          "effort": "S",
          "options": [
            "Keep both anonymous + email/password",
            "Drop anonymous, require email/password only (simpler)"
          ]
        },
        {
          "id": "PAIR-1",
          "summary": "Harden PairingScreen flow",
          "description": "Ensure create couple shows invite code and waits for partner. Join flow handles errors gracefully. Add loading and error states.",
          "status": "todo",
          "priority": "P0",
          "effort": "M",
          "acceptance": [
            "Player 1 can create couple and see invite code",
            "Player 2 can join with valid code",
            "Invalid/expired/used codes show clear error",
            "Both players see active status when paired"
          ]
        },
        {
          "id": "GAMESTATE-1",
          "summary": "Verify couple/user Firestore listeners",
          "description": "Test sign-in, create couple, join from partner account, refresh browser. Fix any race conditions.",
          "status": "todo",
          "priority": "P0",
          "effort": "S",
          "acceptance": [
            "Couple data syncs in real-time between partners",
            "Page refresh maintains correct state",
            "No stale data after partner actions"
          ]
        }
      ]
    },
    {
      "id": "P1_core_loop",
      "name": "Solidify Core Loop Screens",
      "status": "todo",
      "priority": "high",
      "description": "Complete the main gameplay screens: log attempt, acknowledge, requests, suggestions",
      "tasks": [
        {
          "id": "LOG-1",
          "summary": "Complete Log Attempt UX",
          "description": "Show partner's active requests at top. Show partner's suggestions with category filter. Support selecting suggestion to auto-fill action. Handle errors with user-friendly messages.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "Partner's active requests displayed prominently",
            "Partner's suggestions shown and filterable by category",
            "Selecting suggestion auto-fills form",
            "Success/error toasts on submit"
          ]
        },
        {
          "id": "LOG-2",
          "summary": "Enforce daily attempt limit (20/day)",
          "description": "Before logging attempt, query today's attempts by user. If >= 20, show error and prevent submission.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "User cannot log more than 20 attempts per day",
            "Clear error message when limit reached",
            "Counter resets at midnight"
          ]
        },
        {
          "id": "ACK-1",
          "summary": "Complete Acknowledge screen",
          "description": "Query attempts for current user. Provide filters (All/Pending/Acknowledged). Wire acknowledge button with optimistic updates.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "Pending attempts from partner displayed",
            "Filter toggles work correctly",
            "Acknowledge button triggers gem/cup rewards",
            "Visual confirmation on acknowledge"
          ]
        },
        {
          "id": "REQ-1",
          "summary": "Complete Make Request screen with limits",
          "description": "Create request for partner. Show active and fulfilled requests. Enforce max 5 active requests per user.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "Can create request with action, category, description",
            "Active requests list shows current requests",
            "Cannot create more than 5 active requests",
            "Fulfilled requests shown in history"
          ]
        },
        {
          "id": "SUG-1",
          "summary": "Complete Manage Suggestions screen",
          "description": "List user's suggestions organized by category. Add/delete suggestions. Use 9 love language categories from PRD.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "categories": [
            "Words of Affirmation",
            "Acts of Service",
            "Quality Time",
            "Physical Touch",
            "Gifts",
            "Support & Encouragement",
            "Listening & Presence",
            "Shared Activities",
            "Surprises & Thoughtfulness"
          ],
          "acceptance": [
            "Suggestions grouped by category",
            "Can add new suggestion with category",
            "Can delete existing suggestion",
            "Suggestions available to partner in Log Attempt"
          ]
        }
      ]
    },
    {
      "id": "P2_dashboard",
      "name": "Dashboard & Visualizations",
      "status": "todo",
      "priority": "high",
      "description": "Build the main home screen with cup visualizations and stats",
      "tasks": [
        {
          "id": "DASH-1",
          "summary": "Build Home dashboard",
          "description": "Replace placeholder HomeScreen. Show two individual cups with fill levels. Show collective cup. Display gem counts for both players. Quick stats for pending attempts and active requests. Navigation to all features.",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "Both player cups shown with fill levels (0-100)",
            "Collective cup visualization",
            "Gem counts for both players visible",
            "Quick stats: pending attempts, active requests",
            "Navigation to Log, Acknowledge, Request, Suggestions"
          ]
        },
        {
          "id": "DASH-2",
          "summary": "Real-time cup/gem updates",
          "description": "Add Firestore listener on players subcollection. Dashboard updates without refresh when partner takes action.",
          "status": "todo",
          "priority": "P1",
          "effort": "S",
          "acceptance": [
            "Cup levels update in real-time",
            "Gem counts update in real-time",
            "No manual refresh needed"
          ]
        },
        {
          "id": "CUP-1",
          "summary": "Cup visualization component",
          "description": "Animated cup component showing fill level. Visual styling per PRD (gradient fills, smooth animations).",
          "status": "todo",
          "priority": "P1",
          "effort": "M",
          "acceptance": [
            "Cup shows fill level 0-100",
            "Smooth animation when level changes",
            "Visually appealing design"
          ]
        }
      ]
    },
    {
      "id": "P3_polish",
      "name": "Polish & Celebrations",
      "status": "todo",
      "priority": "medium",
      "description": "Add delight with animations, celebrations, and polished UX",
      "tasks": [
        {
          "id": "UX-1",
          "summary": "Cup overflow celebrations",
          "description": "Use cupOverflow and collectiveCupOverflow flags from acknowledgeAttempt. Trigger CupOverflowCelebration overlay with confetti/gem burst animation.",
          "status": "todo",
          "priority": "P2",
          "effort": "M",
          "acceptance": [
            "Celebration triggers when cup overflows",
            "Confetti or gem burst animation plays",
            "Works for both individual and collective cup"
          ]
        },
        {
          "id": "UX-2",
          "summary": "Standardize toast notifications",
          "description": "Create consistent toast/toaster component. Use for all success/error states across app.",
          "status": "todo",
          "priority": "P2",
          "effort": "S",
          "acceptance": [
            "Log attempt success shows toast with gem count",
            "Request fulfillment shows special celebration toast",
            "Acknowledge success shows gem reward toast",
            "Errors show clear error toasts"
          ]
        },
        {
          "id": "UX-3",
          "summary": "Loading and empty states",
          "description": "Every screen handles loading indicators and empty states with friendly copy.",
          "status": "todo",
          "priority": "P2",
          "effort": "S",
          "acceptance": [
            "Loading spinner shown during Firestore queries",
            "Empty states have helpful messages",
            "No broken UI when data is loading"
          ]
        }
      ]
    },
    {
      "id": "P4_history",
      "name": "History & Analytics",
      "status": "todo",
      "priority": "medium",
      "description": "Allow players to review history and see basic analytics",
      "tasks": [
        {
          "id": "HIST-1",
          "summary": "Build history timeline",
          "description": "New HistoryScreen with timeline of attempts. Show action, description, timestamp, acknowledgment status, request link, category. Filters for date range and status.",
          "status": "todo",
          "priority": "P2",
          "effort": "M",
          "acceptance": [
            "Timeline shows all attempts chronologically",
            "Filter by: Last 7 days, 30 days, All",
            "Filter by: Pending/Acknowledged",
            "Request fulfillment indicated when applicable"
          ]
        },
        {
          "id": "ANALYTICS-1",
          "summary": "Basic analytics display",
          "description": "Show simple stats computed from attempt/request data: total attempts per player, acknowledgment rate, most used categories, request fulfillment rate.",
          "status": "todo",
          "priority": "P2",
          "effort": "M",
          "acceptance": [
            "Total attempts shown per player",
            "Acknowledgment rate percentage displayed",
            "Most used categories listed",
            "Request fulfillment rate shown"
          ]
        }
      ]
    },
    {
      "id": "P5_notifications",
      "name": "Notifications",
      "status": "todo",
      "priority": "low",
      "description": "Push notifications for key events (requires Blaze plan or alternative)",
      "blockers": ["Requires Firebase Blaze plan for Cloud Functions or alternative notification service"],
      "tasks": [
        {
          "id": "NOTIF-1",
          "summary": "Explore push notification strategy",
          "description": "Decide if upgrading to Blaze plan or using alternate service. Consider in-app notification center as interim solution.",
          "status": "todo",
          "priority": "P3",
          "effort": "L",
          "notificationTriggers": [
            "Partner logged attempt",
            "Partner acknowledged your attempt",
            "Partner made request for you",
            "Partner fulfilled your request",
            "Cup overflow"
          ]
        },
        {
          "id": "NOTIF-2",
          "summary": "In-app notification center",
          "description": "Pull-to-refresh list of recent events as alternative to push notifications.",
          "status": "todo",
          "priority": "P3",
          "effort": "M"
        }
      ]
    },
    {
      "id": "P6_extended",
      "name": "Extended Features",
      "status": "todo",
      "priority": "low",
      "description": "Streaks, achievements, customization - post-MVP",
      "tasks": [
        {
          "id": "STREAK-1",
          "summary": "Implement streak tracking",
          "description": "Track consecutive days of activity. Display current streak on dashboard.",
          "status": "todo",
          "priority": "P4",
          "effort": "M"
        },
        {
          "id": "ACH-1",
          "summary": "Achievement system",
          "description": "Define achievements for milestones. Track unlock progress. Show earned achievements.",
          "status": "todo",
          "priority": "P4",
          "effort": "L"
        },
        {
          "id": "THEME-1",
          "summary": "Theme customization",
          "description": "Allow users to choose themes or customize colors.",
          "status": "todo",
          "priority": "P4",
          "effort": "M"
        }
      ]
    }
  ],

  "dataModels": {
    "note": "Already implemented in Firestore - see PRD_figma.md for full schemas",
    "collections": [
      "users",
      "couples",
      "couples/{id}/players",
      "couples/{id}/attempts",
      "couples/{id}/requests",
      "couples/{id}/suggestions",
      "inviteCodes"
    ]
  },

  "gameConstants": {
    "BASE_GEM_AWARD": 1,
    "REQUEST_FULFILLMENT_BONUS": 2,
    "ACK_GEM_AWARD": 3,
    "ACK_COLLECTIVE_CUP_AWARD": 3,
    "DAILY_ATTEMPT_LIMIT": 20,
    "MAX_ACTIVE_REQUESTS_PER_PLAYER": 5,
    "CUP_MAX_LEVEL": 100,
    "DEFAULT_POINTS_PER_ACKNOWLEDGMENT": 5
  },

  "techStack": {
    "frontend": "Expo (React Native) with web support",
    "backend": "Firebase (Spark plan - free tier)",
    "database": "Firestore",
    "auth": "Firebase Authentication",
    "hosting": "Firebase Hosting",
    "deployedUrl": "https://twocups-2026.web.app"
  },

  "nextSteps": [
    "1. Review this PRD and approve priorities",
    "2. Execute P0 tasks (auth/pairing fixes)",
    "3. Build P1 core loop screens",
    "4. Build P2 dashboard with visualizations",
    "5. Add P3 polish and celebrations",
    "6. Ship MVP and gather feedback"
  ]
}
